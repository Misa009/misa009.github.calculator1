<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
<meta name="theme-color" content="#000000" />

<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

<title>Calculadora</title>

<style>
:root{
  --bg:#000000;
  --key-dark:#333333;
  --key-fn:#a5a5a5;
  --key-op:#ff9f0a;
  --key-op-press:#ffb84d;
  --text:#ffffff;

  /* ðŸ”§ ajuste fino: controla lo alto que quedan los botones */
  --bottom-lift: 28px; /* sÃºbelo/bÃ¡jalo aquÃ­ */
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Display","SF Pro Text",system-ui;
}

*{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

html, body{
  margin:0;
  height:100%;
  width:100%;
  background:var(--bg);
  color:var(--text);
  overflow:hidden;
  overscroll-behavior:none;
}

body{
  position:fixed;
  inset:0;
  background:var(--bg);
  touch-action:none;
}

.calculator{
  width:100vw;
  height:100svh;
  background:var(--bg);
  display:flex;
  flex-direction:column;
  justify-content:flex-end;
  padding:
    env(safe-area-inset-top)
    max(14px, env(safe-area-inset-right))
    max(calc(env(safe-area-inset-bottom) - var(--bottom-lift)), 8px)
    max(14px, env(safe-area-inset-left));
}

.display-wrap{
  position:relative;
  padding: 0 6px 6px 6px;
}

.display{
  height:132px;
  display:flex;
  align-items:flex-end;
  justify-content:flex-end;
}

.display span{
  font-size:72px;
  font-weight:300;
  letter-spacing:-0.02em;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.badge{
  position:absolute;
  right:8px;
  top:6px;
  padding:6px 10px;
  font-size:12px;
  letter-spacing:.02em;
  color:rgba(255,255,255,.85);
  background:rgba(255,255,255,.12);
  border:1px solid rgba(255,255,255,.12);
  border-radius:999px;
  backdrop-filter: blur(10px);
  display:none;
}
.badge.show{ display:inline-flex; gap:6px; }

.keys{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:14px;
  margin-bottom: var(--bottom-lift); /* ðŸ‘ˆ subimos el bloque entero */
}

button{
  border:none;
  border-radius:999px;
  height:74px;
  font-size:32px;
  cursor:pointer;
  user-select:none;
  -webkit-user-select:none;
  touch-action:manipulation;
}

button:active{ filter:brightness(1.12); }

.key-num{ background:var(--key-dark); color:#fff; }
.key-fn{ background:var(--key-fn); color:#000; }
.key-op{ background:var(--key-op); color:#fff; }
.key-op:active{ background:var(--key-op-press); }

@media(max-width:380px){
  .display{ height:120px; }
  .display span{ font-size:62px; }
  button{ height:68px; font-size:30px; }
  .keys{ gap:12px; }
}
</style>
</head>

<body>
<div class="calculator">
  <div class="display-wrap">
    <div class="badge" id="badge"><strong>VersiÃ³n</strong><span>v0.1</span></div>
    <div class="display"><span id="display">0</span></div>
  </div>

  <div class="keys">
    <button class="key-fn" data-action="backspace">âŒ«</button>
    <button class="key-fn" data-action="ac">AC</button>
    <button class="key-fn" data-action="percent">%</button>
    <button class="key-op" data-op="Ã·">Ã·</button>

    <button class="key-num" data-num="7">7</button>
    <button class="key-num" data-num="8">8</button>
    <button class="key-num" data-num="9">9</button>
    <button class="key-op" data-op="Ã—">Ã—</button>

    <button class="key-num" data-num="4">4</button>
    <button class="key-num" data-num="5">5</button>
    <button class="key-num" data-num="6">6</button>
    <button class="key-op" data-op="âˆ’">âˆ’</button>

    <button class="key-num" id="key-1" data-num="1">1</button>
    <button class="key-num" data-num="2">2</button>
    <button class="key-num" data-num="3">3</button>
    <button class="key-op" data-op="+">+</button>

    <button class="key-num" data-action="sign">Â±</button>
    <button class="key-num" data-num="0">0</button>
    <button class="key-num" data-action="dot">,</button>
    <button class="key-op" data-action="equals">=</button>
  </div>
</div>

<script>
/* bloquear gestos */
document.addEventListener('touchstart',e=>{if(e.touches&&e.touches.length>1)e.preventDefault()},{passive:false});
document.addEventListener('touchmove',e=>e.preventDefault(),{passive:false});
document.addEventListener('wheel',e=>e.preventDefault(),{passive:false});
['gesturestart','gesturechange','gestureend'].forEach(ev=>{
  document.addEventListener(ev,e=>e.preventDefault(),{passive:false});
});
let lastTouchEnd=0;
document.addEventListener('touchend',e=>{
  const now=Date.now();
  if(now-lastTouchEnd<=300)e.preventDefault();
  lastTouchEnd=now;
},{passive:false});

/* lÃ³gica calculadora */
const d=document.getElementById("display");
const badge=document.getElementById("badge");
let a=null,b=null,op=null,typing=false,lastEq=false;

const displayToNumber=()=>Number(d.textContent.replace(",","."));
const numberToDisplay=n=>{
  if(!isFinite(n))return"Error";
  let s=n.toString();
  if(s.length>12)s=n.toExponential(6).replace("+","");
  return s.replace(".",",");
};
const set=t=>d.textContent=t;

function clearAll(){a=b=op=null;typing=lastEq=false;set("0")}
function backspace(){
  if(d.textContent==="Error"){clearAll();return}
  let c=d.textContent;
  if(c.length<=1){set("0");typing=false;return}
  c=c.slice(0,-1);
  if(c.endsWith(","))c=c.slice(0,-1);
  if(c===""||c==="âˆ’"){set("0");typing=false;return}
  set(c);typing=true;
}
function digit(n){
  if(lastEq){clearAll();typing=true;set(n);return}
  if(!typing||d.textContent==="0"){typing=true;set(n);return}
  if(d.textContent.length<14)set(d.textContent+n)
}
function dot(){
  if(lastEq){clearAll();typing=true;set("0,");return}
  if(!typing){typing=true;set("0,");return}
  if(!d.textContent.includes(","))set(d.textContent+",")
}
function sign(){set(numberToDisplay(-displayToNumber()));typing=true}
function percent(){set(numberToDisplay(displayToNumber()/100));typing=true}
function choose(o){
  if(a===null){a=displayToNumber();op=o;typing=false;lastEq=false;return}
  if(typing)equals();
  op=o;lastEq=false;
}
function equals(){
  if(op===null)return;
  b=displayToNumber();
  let r;
  switch(op){
    case"+":r=a+b;break;
    case"âˆ’":r=a-b;break;
    case"Ã—":r=a*b;break;
    case"Ã·":r=b===0?NaN:a/b;break;
  }
  set(numberToDisplay(r));
  a=r;typing=false;lastEq=true;
}

document.addEventListener("click",e=>{
  const btn=e.target.closest("button");
  if(!btn)return;
  if(btn.dataset.num)digit(btn.dataset.num);
  if(btn.dataset.op)choose(btn.dataset.op);
  switch(btn.dataset.action){
    case"ac":clearAll();break;
    case"backspace":backspace();break;
    case"dot":dot();break;
    case"sign":sign();break;
    case"percent":percent();break;
    case"equals":equals();break;
  }
});

/* long press en 1 */
(function(){
  const k=document.getElementById("key-1");
  let t=null;
  const start=()=>{t=setTimeout(()=>badge.classList.toggle("show"),520)}
  const end=()=>{clearTimeout(t)}
  k.addEventListener("touchstart",start,{passive:true});
  k.addEventListener("touchend",end,{passive:true});
  k.addEventListener("mousedown",start);
  k.addEventListener("mouseup",end);
})();
</script>
</body>
</html>
